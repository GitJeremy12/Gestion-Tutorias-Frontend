<div class="reporte-container">
  <div class="reporte-header">
    <h2>Reporte Semanal de TutorÃ­as</h2>
    <p class="subtitle">Genera y analiza reportes de actividad semanal</p>
  </div>

  <!-- Selector de semana y generador -->
  <div class="form-section">
    <div class="week-selector">
      <div class="form-group">
        <label for="semana">
          <span class="label-icon">ğŸ“…</span>
          Seleccionar Semana
        </label>
        <input
          type="week"
          id="semana"
          [(ngModel)]="semana"
          name="semana"
          [max]="getMaxWeek()"
          class="week-input"
        />
        <small class="hint">Selecciona la semana para generar el reporte</small>
      </div>

      <button
        class="btn-generate"
        (click)="generarReporte()"
        [disabled]="!semana || generando">
        <span *ngIf="!generando">
          <span class="btn-icon">ğŸ“Š</span>
          Generar Reporte
        </span>
        <span *ngIf="generando" class="loading-content">
          <span class="spinner"></span>
          Generando...
        </span>
      </button>
    </div>

    <!-- Mensaje de error -->
    <p class="error-message" *ngIf="error">
      <span class="error-icon">âš ï¸</span>
      {{ error }}
    </p>
  </div>

  <!-- Reporte generado -->
  <div class="reporte-content" *ngIf="reporte">

    <!-- Resumen general -->
    <div class="summary-section">
      <h3 class="section-title">
        <span class="title-icon">ğŸ“ˆ</span>
        Resumen General
      </h3>

      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-icon">ğŸ“š</div>
          <div class="stat-info">
            <span class="stat-label">Total de TutorÃ­as</span>
            <span class="stat-value">{{ reporte.totalTutorias }}</span>
          </div>
        </div>

        <div class="stat-card success" *ngIf="reporte.completadas !== undefined">
          <div class="stat-icon">âœ“</div>
          <div class="stat-info">
            <span class="stat-label">Completadas</span>
            <span class="stat-value">{{ reporte.completadas }}</span>
          </div>
        </div>

        <div class="stat-card warning" *ngIf="reporte.canceladas !== undefined">
          <div class="stat-icon">ğŸš«</div>
          <div class="stat-info">
            <span class="stat-label">Canceladas</span>
            <span class="stat-value">{{ reporte.canceladas }}</span>
          </div>
        </div>

        <div class="stat-card info" *ngIf="reporte.horasTotales !== undefined">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-info">
            <span class="stat-label">Horas Totales</span>
            <span class="stat-value">{{ reporte.horasTotales }}h</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Materias mÃ¡s solicitadas -->
    <div class="data-section">
      <h3 class="section-title">
        <span class="title-icon">ğŸ“–</span>
        Materias MÃ¡s Solicitadas
      </h3>

      <div class="ranking-list" *ngIf="reporte.materias && reporte.materias.length > 0; else noMaterias">
        <div class="ranking-item" *ngFor="let m of reporte.materias; let i = index">
          <div class="rank-badge" [class.top-three]="i < 3">
            <span class="rank-number">{{ i + 1 }}</span>
          </div>
          <div class="rank-content">
            <span class="rank-name">{{ m.nombre }}</span>
            <div class="rank-bar">
              <div class="rank-progress" [style.width.%]="getPercentage(m.total, reporte.totalTutorias)"></div>
            </div>
          </div>
          <div class="rank-value">
            <span class="value-number">{{ m.total }}</span>
            <span class="value-label">tutorÃ­as</span>
          </div>
        </div>
      </div>

      <ng-template #noMaterias>
        <div class="empty-data">
          <p>No hay datos de materias para mostrar</p>
        </div>
      </ng-template>
    </div>

    <!-- Tutores mÃ¡s activos -->
    <div class="data-section">
      <h3 class="section-title">
        <span class="title-icon">ğŸ‘¨â€ğŸ«</span>
        Tutores MÃ¡s Activos
      </h3>

      <div class="ranking-list" *ngIf="reporte.tutores && reporte.tutores.length > 0; else noTutores">
        <div class="ranking-item" *ngFor="let t of reporte.tutores; let i = index">
          <div class="rank-badge" [class.top-three]="i < 3">
            <span class="rank-number">{{ i + 1 }}</span>
          </div>
          <div class="rank-content">
            <span class="rank-name">{{ t.nombre }}</span>
            <div class="rank-bar">
              <div class="rank-progress tutor" [style.width.%]="getPercentage(t.total, reporte.totalTutorias)"></div>
            </div>
          </div>
          <div class="rank-value">
            <span class="value-number">{{ t.total }}</span>
            <span class="value-label">tutorÃ­as</span>
          </div>
        </div>
      </div>

      <ng-template #noTutores>
        <div class="empty-data">
          <p>No hay datos de tutores para mostrar</p>
        </div>
      </ng-template>
    </div>

    <!-- GrÃ¡ficos -->
    <div class="charts-section" *ngIf="mostrarGraficos">
      <div class="charts-header">
        <h3 class="section-title">
          <span class="title-icon">ğŸ“Š</span>
          VisualizaciÃ³n de Datos
        </h3>
        <button class="btn-toggle-charts" (click)="toggleGraficos()">
          <span *ngIf="!graficosGenerados">Mostrar GrÃ¡ficos</span>
          <span *ngIf="graficosGenerados">Ocultar GrÃ¡ficos</span>
        </button>
      </div>

      <div class="charts-grid" *ngIf="graficosGenerados">
        <div class="chart-container">
          <h4>DistribuciÃ³n por Materias</h4>
          <canvas id="chartMaterias"></canvas>
        </div>
        <div class="chart-container">
          <h4>Actividad por Tutor</h4>
          <canvas id="chartTutores"></canvas>
        </div>
      </div>
    </div>

    <!-- Botones de exportaciÃ³n -->
    <div class="export-section">
      <h3 class="section-title">
        <span class="title-icon">ğŸ’¾</span>
        Exportar Reporte
      </h3>

      <div class="export-buttons">
        <button class="btn-export pdf" (click)="exportarPDF()" [disabled]="exportando">
          <span class="export-icon">ğŸ“„</span>
          <div class="export-info">
            <span class="export-title">Exportar PDF</span>
            <span class="export-desc">Documento imprimible</span>
          </div>
        </button>

        <button class="btn-export excel" (click)="exportarExcel()" [disabled]="exportando">
          <span class="export-icon">ğŸ“Š</span>
          <div class="export-info">
            <span class="export-title">Exportar Excel</span>
            <span class="export-desc">Hoja de cÃ¡lculo</span>
          </div>
        </button>

        <button class="btn-export csv" (click)="exportarCSV()" [disabled]="exportando" *ngIf="false">
          <span class="export-icon">ğŸ“‹</span>
          <div class="export-info">
            <span class="export-title">Exportar CSV</span>
            <span class="export-desc">Datos en texto</span>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Estado vacÃ­o -->
  <div class="empty-state" *ngIf="!reporte && !error && reporteBuscado">
    <div class="empty-icon">ğŸ“Š</div>
    <h3>No hay datos disponibles</h3>
    <p>No se encontraron tutorÃ­as para la semana seleccionada</p>
  </div>
</div>
