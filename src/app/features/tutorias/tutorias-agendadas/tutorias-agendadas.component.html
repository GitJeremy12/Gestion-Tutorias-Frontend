<div class="agendadas-container">
  <div class="agendadas-header">
    <h2>Mis TutorÃ­as Agendadas</h2>
    <p class="subtitle">Gestiona tus prÃ³ximas sesiones de tutorÃ­a</p>
  </div>

  <!-- Filtros y acciones rÃ¡pidas -->
  <div class="actions-bar" *ngIf="tutorias.length > 0">
    <div class="stats-summary">
      <div class="stat-item">
        <span class="stat-number">{{ tutorias.length }}</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ getTutoriasProximas() }}</span>
        <span class="stat-label">PrÃ³ximas 7 dÃ­as</span>
      </div>
    </div>
    <button class="btn-new" routerLink="/agendar">
      <span>â•</span>
      Nueva TutorÃ­a
    </button>
  </div>

  <!-- Tabla de tutorÃ­as -->
  <div class="table-container" *ngIf="tutorias.length > 0; else noTutorias">
    <div class="table-wrapper">
      <table class="tutorias-table">
        <thead>
          <tr>
            <th>Fecha y Hora</th>
            <th>Materia</th>
            <th>Tema</th>
            <th>Tutor</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of tutorias; let i = index"
              [class.row-even]="i % 2 === 0"
              [class.row-proxima]="esProxima(t)">
            <td data-label="Fecha y Hora">
              <div class="date-cell">
                <span class="date-icon">ğŸ“…</span>
                <div class="date-info">
                  <span class="date-day">{{ t.fecha | date:'dd/MM/yyyy' }}</span>
                  <span class="date-time">{{ t.fecha | date:'HH:mm' }}</span>
                  <span class="time-remaining" *ngIf="getTiempoRestante(t)">
                    {{ getTiempoRestante(t) }}
                  </span>
                </div>
              </div>
            </td>
            <td data-label="Materia">
              <span class="materia-badge">{{ t.materia }}</span>
            </td>
            <td data-label="Tema">
              <span class="tema-text">{{ t.tema || 'Sin tema especÃ­fico' }}</span>
            </td>
            <td data-label="Tutor">
              <div class="tutor-cell">
                <span class="tutor-icon">ğŸ‘¨â€ğŸ«</span>
                <span class="tutor-name">{{ t.tutor?.nombre || 'N/A' }}</span>
              </div>
            </td>
            <td data-label="Estado">
              <span class="status-badge" [ngClass]="getEstadoClass(t.estado)">
                {{ getEstadoTexto(t.estado) }}
              </span>
            </td>
            <td data-label="Acciones">
              <div class="action-buttons">
                <button class="btn-action btn-detail" (click)="verDetalle(t)" title="Ver detalles">
                  <span>ğŸ‘ï¸</span>
                </button>
                <button
                  class="btn-action btn-cancel"
                  *ngIf="t.estado === 'agendada'"
                  (click)="abrirModal(t)"
                  title="Cancelar tutorÃ­a">
                  <span>ğŸš«</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Estado vacÃ­o -->
  <ng-template #noTutorias>
    <div class="empty-state">
      <div class="empty-icon">ğŸ“š</div>
      <h3>No tienes tutorÃ­as agendadas</h3>
      <p>Agenda tu primera tutorÃ­a para comenzar</p>
      <button class="btn-primary" routerLink="/agendar">
        <span>â•</span>
        Agendar TutorÃ­a
      </button>
    </div>
  </ng-template>

  <!-- Modal de cancelaciÃ³n -->
  <app-cancel-modal
    *ngIf="selectedTutoria"
    [tutoria]="selectedTutoria"
    (cancelada)="onCancelada()"
    (cerrar)="selectedTutoria = null">
  </app-cancel-modal>

  <!-- Modal de detalle (opcional) -->
  <div class="modal-overlay" *ngIf="tutoriaDetalle" (click)="cerrarDetalle()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Detalle de TutorÃ­a</h3>
        <button class="btn-close" (click)="cerrarDetalle()">
          <span>âœ•</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="detail-section">
          <h4>InformaciÃ³n General</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-icon">ğŸ“…</span>
              <div class="detail-content">
                <span class="detail-label">Fecha</span>
                <span class="detail-value">{{ tutoriaDetalle.fecha | date:'fullDate':'':'es-ES' }}</span>
              </div>
            </div>

            <div class="detail-item">
              <span class="detail-icon">ğŸ•</span>
              <div class="detail-content">
                <span class="detail-label">Hora</span>
                <span class="detail-value">{{ tutoriaDetalle.fecha | date:'HH:mm' }}</span>
              </div>
            </div>

            <div class="detail-item">
              <span class="detail-icon">ğŸ‘¨â€ğŸ«</span>
              <div class="detail-content">
                <span class="detail-label">Tutor</span>
                <span class="detail-value">{{ tutoriaDetalle.tutor?.nombre || 'No disponible' }}</span>
              </div>
            </div>

            <div class="detail-item" *ngIf="tutoriaDetalle.tutor?.especialidad">
              <span class="detail-icon">ğŸ“</span>
              <div class="detail-content">
                <span class="detail-label">Especialidad</span>
                <span class="detail-value">{{ tutoriaDetalle.tutor.especialidad }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4>Detalles AcadÃ©micos</h4>
          <div class="detail-grid">
            <div class="detail-item full-width">
              <span class="detail-icon">ğŸ“š</span>
              <div class="detail-content">
                <span class="detail-label">Materia</span>
                <span class="detail-value">{{ tutoriaDetalle.materia }}</span>
              </div>
            </div>

            <div class="detail-item full-width" *ngIf="tutoriaDetalle.tema">
              <span class="detail-icon">ğŸ“–</span>
              <div class="detail-content">
                <span class="detail-label">Tema</span>
                <span class="detail-value">{{ tutoriaDetalle.tema }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="cerrarDetalle()">
          Cerrar
        </button>
        <button
          class="btn-danger"
          *ngIf="tutoriaDetalle.estado === 'agendada'"
          (click)="abrirModal(tutoriaDetalle)">
          <span>ğŸš«</span>
          Cancelar TutorÃ­a
        </button>
      </div>
    </div>
  </div>
</div>
