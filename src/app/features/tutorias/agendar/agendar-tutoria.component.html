<div class="schedule-container">
  <div class="schedule-header">
    <h2>Agendar TutorÃ­a</h2>
    <p class="subtitle">Selecciona tu tutor y horario preferido</p>
  </div>

  <form #f="ngForm" (ngSubmit)="confirmar(f)">

    <!-- SelecciÃ³n de tutor -->
    <div class="form-section">
      <h3 class="section-title">Selecciona tu tutor</h3>

      <div class="form-group">
        <label for="tutorId">Tutor disponible</label>
        <select
          [(ngModel)]="form.tutorId"
          id="tutorId"
          name="tutorId"
          required
          (change)="onTutorChange()">
          <option value="" disabled>Elige un tutor</option>
          <option *ngFor="let t of tutores" [value]="t.id">
            ğŸ‘¨â€ğŸ« {{ t.nombre }} â€“ {{ t.especialidad }}
          </option>
        </select>
      </div>

      <!-- Info del tutor seleccionado -->
      <div class="tutor-info" *ngIf="tutorSeleccionado">
        <div class="info-card">
          <span class="info-label">ğŸ“š Especialidad:</span>
          <span class="info-value">{{ tutorSeleccionado.especialidad }}</span>
        </div>
        <div class="info-card" *ngIf="tutorSeleccionado.departamento">
          <span class="info-label">ğŸ¢ Departamento:</span>
          <span class="info-value">{{ tutorSeleccionado.departamento }}</span>
        </div>
        <div class="info-card" *ngIf="tutorSeleccionado.disponibilidad">
          <span class="info-label">ğŸ• Disponibilidad:</span>
          <span class="info-value">{{ tutorSeleccionado.disponibilidad }}</span>
        </div>
      </div>
    </div>

    <!-- Detalles de la tutorÃ­a -->
    <div class="form-section">
      <h3 class="section-title">Detalles de la tutorÃ­a</h3>

      <div class="form-group">
        <label for="materia">Materia</label>
        <input
          type="text"
          id="materia"
          [(ngModel)]="form.materia"
          name="materia"
          placeholder="Ej: CÃ¡lculo Diferencial"
          required
          autocomplete="off"
        />
      </div>

      <div class="form-group">
        <label for="tema">Tema especÃ­fico</label>
        <input
          type="text"
          id="tema"
          [(ngModel)]="form.tema"
          name="tema"
          placeholder="Ej: Derivadas parciales"
          required
          autocomplete="off"
        />
        <small class="hint">Describe brevemente el tema que necesitas revisar</small>
      </div>
    </div>

    <!-- Fecha y hora -->
    <div class="form-section">
      <h3 class="section-title">Fecha y hora</h3>

      <div class="form-group">
        <label for="fechaHora">Selecciona fecha y hora</label>
        <input
          type="datetime-local"
          id="fechaHora"
          [(ngModel)]="form.fechaHora"
          name="fechaHora"
          required
          [min]="setMinDateTime()"
          (change)="validarHorario()"
        />
        <small class="hint">Selecciona un horario dentro del horario laboral</small>
      </div>

      <!-- Indicador de disponibilidad -->
      <div class="availability-indicator" *ngIf="form.fechaHora && form.tutorId">
        <div class="indicator validating" *ngIf="validandoHorario">
          <span class="indicator-icon">â³</span>
          <span class="indicator-text">Verificando disponibilidad...</span>
        </div>
        <div class="indicator available" *ngIf="disponible && !validandoHorario">
          <span class="indicator-icon">âœ“</span>
          <span class="indicator-text">Horario disponible</span>
        </div>
        <div class="indicator unavailable" *ngIf="!disponible && !validandoHorario && form.fechaHora">
          <span class="indicator-icon">âœ•</span>
          <span class="indicator-text">Horario no disponible</span>
        </div>
      </div>
    </div>

    <!-- Horarios alternativos -->
    <div class="alternative-times" *ngIf="horariosAlternativos.length > 0">
      <h4>ğŸ“… Horarios alternativos disponibles</h4>
      <p class="alternative-subtitle">El horario seleccionado no estÃ¡ disponible. Prueba estos:</p>
      <ul class="times-list">
        <li *ngFor="let h of horariosAlternativos"
            class="time-item"
            (click)="seleccionarHorarioAlternativo(h)">
          <span class="time-icon">ğŸ•</span>
          <span class="time-text">{{ formatearFecha(h) }}</span>
        </li>
      </ul>
    </div>

    <!-- Mensajes de Ã©xito/error -->
    <p class="success" *ngIf="success">
      <span class="success-icon">âœ“</span>
      {{ success }}
    </p>
    <p class="error" *ngIf="error">
      <span class="error-icon">âš ï¸</span>
      {{ error }}
    </p>

    <!-- BotÃ³n de confirmaciÃ³n -->
    <button
      type="submit"
      [disabled]="!f.form.valid || !disponible"
      [class.disabled]="!disponible">
      <span *ngIf="disponible">Confirmar agendamiento</span>
      <span *ngIf="!disponible && form.tutorId && form.fechaHora">Selecciona un horario disponible</span>
      <span *ngIf="!form.tutorId || !form.fechaHora">Completa el formulario</span>
    </button>

    <!-- Link de navegaciÃ³n -->
    <div class="back-link">
      <a href="#" routerLink="/mis-tutorias">â† Volver a mis tutorÃ­as</a>
    </div>
  </form>
</div>
