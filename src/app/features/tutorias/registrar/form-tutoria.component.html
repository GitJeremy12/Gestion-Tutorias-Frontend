<div class="register-tutoria-container">
  <div class="register-header">
    <h2>Registrar TutorÃ­a</h2>
    <p class="subtitle">Registra una tutorÃ­a realizada o programa una nueva</p>
  </div>

  <form #f="ngForm" (ngSubmit)="guardar(f)">

    <!-- InformaciÃ³n del Estudiante -->
    <div class="form-section">
      <h3 class="section-title">Estudiante</h3>

      <div class="form-group">
        <label for="estudianteId">Selecciona el estudiante</label>
        <select
          [(ngModel)]="form.estudianteId"
          id="estudianteId"
          name="estudianteId"
          required
          (change)="onEstudianteChange()">
          <option value="" disabled>Selecciona un estudiante</option>
          <option *ngFor="let e of estudiantes" [value]="e.id">
            ğŸ‘¨â€ğŸ“ {{ e.nombre }} - {{ e.carrera || 'Sin carrera' }}
          </option>
        </select>
      </div>

      <!-- Info del estudiante seleccionado -->
      <div class="estudiante-info" *ngIf="estudianteSeleccionado">
        <div class="info-card">
          <span class="info-icon">ğŸ“š</span>
          <div class="info-content">
            <span class="info-label">Carrera</span>
            <span class="info-value">{{ estudianteSeleccionado.carrera || 'No especificada' }}</span>
          </div>
        </div>
        <div class="info-card" *ngIf="estudianteSeleccionado.semestre">
          <span class="info-icon">ğŸ“–</span>
          <div class="info-content">
            <span class="info-label">Semestre</span>
            <span class="info-value">{{ estudianteSeleccionado.semestre }}Â°</span>
          </div>
        </div>
        <div class="info-card" *ngIf="estudianteSeleccionado.email">
          <span class="info-icon">ğŸ“§</span>
          <div class="info-content">
            <span class="info-label">Email</span>
            <span class="info-value">{{ estudianteSeleccionado.email }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Fecha y Hora -->
    <div class="form-section">
      <h3 class="section-title">Fecha y Hora</h3>

      <div class="form-group">
        <label for="fechaHora">Selecciona fecha y hora de la tutorÃ­a</label>
        <input
          type="datetime-local"
          id="fechaHora"
          [(ngModel)]="form.fechaHora"
          name="fechaHora"
          required
          [max]="getMaxDateTime()"
        />
        <small class="hint">Puedes registrar tutorÃ­as pasadas o futuras</small>
      </div>
    </div>

    <!-- Detalles AcadÃ©micos -->
    <div class="form-section">
      <h3 class="section-title">Detalles AcadÃ©micos</h3>

      <div class="form-group">
        <label for="materia">Materia</label>
        <input
          type="text"
          id="materia"
          [(ngModel)]="form.materia"
          name="materia"
          #materiaField="ngModel"
          placeholder="Ej: CÃ¡lculo Diferencial"
          required
          autocomplete="off"
        />
        <small class="error-hint" *ngIf="materiaField.invalid && (materiaField.dirty || materiaField.touched)">
          âš ï¸ La materia es obligatoria
        </small>
      </div>

      <div class="form-group">
        <label for="tema">Tema tratado</label>
        <input
          type="text"
          id="tema"
          [(ngModel)]="form.tema"
          name="tema"
          placeholder="Ej: Derivadas parciales"
          autocomplete="off"
        />
        <small class="hint">Opcional: Describe el tema especÃ­fico abordado</small>
      </div>

      <div class="form-group">
        <label for="duracion">DuraciÃ³n (minutos)</label>
        <input
          type="number"
          id="duracion"
          [(ngModel)]="form.duracion"
          name="duracion"
          #duracionField="ngModel"
          min="15"
          max="300"
          step="15"
          placeholder="60"
          required
        />
        <small class="hint">DuraciÃ³n tÃ­pica: 60 minutos</small>
        <small class="error-hint" *ngIf="duracionField.invalid && (duracionField.dirty || duracionField.touched)">
          âš ï¸ La duraciÃ³n debe estar entre 15 y 300 minutos
        </small>
      </div>

      <div class="form-group">
        <label for="observaciones">Observaciones</label>
        <textarea
          id="observaciones"
          [(ngModel)]="form.observaciones"
          name="observaciones"
          rows="4"
          placeholder="Escribe observaciones sobre la tutorÃ­a, temas pendientes, material necesario, etc."></textarea>
        <small class="hint">Opcional: Notas adicionales sobre la sesiÃ³n</small>
      </div>
    </div>

    <!-- Mensajes de Ã©xito/error -->
    <p class="success" *ngIf="success">
      <span class="success-icon">âœ“</span>
      {{ success }}
    </p>
    <p class="error" *ngIf="error && !success">
      <span class="error-icon">âš ï¸</span>
      {{ error }}
    </p>

    <!-- Botones de acciÃ³n -->
    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="cancelar()">
        Cancelar
      </button>
      <button type="submit" class="btn-submit" [disabled]="!f.form.valid || guardando">
        <span *ngIf="!guardando">Guardar TutorÃ­a</span>
        <span *ngIf="guardando">
          <span class="spinner-small"></span>
          Guardando...
        </span>
      </button>
    </div>
  </form>
</div>
